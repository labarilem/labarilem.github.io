---
title: "Npmfix"
excerpt: A Node.js CLI that fixes integrity check issues with NPM packages.
categories:
  - Projects
tags:
  - NPM
---

{% include figure image_path="/assets/images/2018-06-05-npmfix/npmfix.png" alt="Logo." %}

A Node.js CLI that fixes integrity check issues with NPM packages.

## The problem

When:

- You [link NPM packages](https://docs.npmjs.com/cli/link) a lot :rocket:
- Integration tests automatically install packages from local tarballs :factory:

And then:

- A build server runs CI builds :wrench: :hammer:

You get:

- CI builds failing with `EINTEGRITY` error codes, representing *integrity check failures*.

**Did you know?** NPM makes sure that the checksum of a published package matches the checksum of the package you download (or fetch from your local cache) in order to avoid bad surprises after the installation.
{: .notice--info}

Something was messing with the checksums in the `package-lock.json` file, causing packages installation errors in the build process.

## Solutions

In theory, you could solve these issues by disabling *package-lock.json* files, but this has some potentially undesired effects:

- You lose the guarantee that build servers and dev machines will install the same packages versions.
- Packages installation will take more time because NPM wouldn't be able to skip metadata resolution.

I embraced this solution for the projects that do not need these features.

But, for the remaining projects, I found myself deleting `package-lock.json` files and `node_modules` folders a lot, sometimes even cleaning the global NPM cache, before pushing changes that would trigger CI builds. And of course then I needed to reinstall the whole lot of packages too. This took some time and I also felt like a human executing a script.

## Automation

So I wrote a Node.js CLI tool to replace me in this tedious task. Npmfix is based on a very simple algorithm:

1. Continue only if the current folder has a package.json file
2. Delete the node_modules folder
3. Delete the package-lock.json file

which can be extended (recursive search, global cache clean, etc.) by passing flags to the CLI.

## More

If you want to know more about Npmfix, visit its [Github repository](https://github.com/labarilem/npmfix).